---
- name: Create temporary GIT_SSH wrapper.
  command: mktemp /tmp/ansible_git_ssh.XXXXXXXXX
  register: tmp_git_ssh
  notify: Cleanup temporary files.

- name: Make GIT_SSH wrapper executable.
  file: name={{ tmp_git_ssh.stdout }} mode="u+x"

- name: Generate GIT_SSH wrapper script to disable StrictHostKeyChecking.
  shell: "echo 'ssh -o BatchMode=yes -o StrictHostKeyChecking=no $*' > {{tmp_git_ssh.stdout}}"
  when: symfony2_ssh_accept_hostkey

- name: Generate GIT_SSH wrapper script.
  shell: "echo 'ssh -o BatchMode=yes $*' > {{tmp_git_ssh.stdout}}"
  when: not symfony2_ssh_accept_hostkey
